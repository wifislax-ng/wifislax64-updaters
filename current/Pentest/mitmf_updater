#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20221028

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=mitmf
	SRCNAM=MITMf
	EXTENSION=gz
	GESTOR=git
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB=https://github.com/byt3bl33d3r/MITMf
	RAMA=$(curl -s $WEB/tags|grep .$EXTENSION|head -1|cut -dv -f3|cut -d t -f-1|sed 's/v//g'|sed 's/.$//g'|sed 's/<m_//g')
	VERSION=$(echo ${RAMA}_"$(curl -s $WEB|grep commit/|head -1|cut -d / -f5|cut -c1-7)")
	SOURCES=$SRCNAM
	CD=$SRCNAM
	DOWNLOAD=$WEB
}

# Comprobar dependencias
F_dependencias(){
DEPENDENCIAS="
click
itsdangerous
python2-MarkupSafe
werkzeug
Flask
python2-pypcap
python2-dnslib
python2-IPy
python2-user-agents
python2-NetfilterQueue
python2-capstone
pyinotify
python2-pycrypto
pyasn1
pyasn1-modules
ipaddress
pycparser
cffi
wheel
asn1crypto
python2-cryptography
python2-netaddr
python2-scapy
zope.interface
constantly
hyperlink
incremental
python2-automat
python2-pyhamcrest
python2-twisted
python3-webencodings
html5lib
python3-soupsieve
BeautifulSoup4
python2-setuptools-scm
functools-lru-cache
python2-soupsieve
python2-BeautifulSoup4
lxml
python2-pefile
python2-pyOpenSSL
characteristic
python2-attrs
service_identity
configobj
dnspython
python-magic
msgpack-python
python2-pillow"
f_dependencias
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
git submodule init && git submodule update --recursive
cd ..

mkdir -p  $PKG/{opt,usr/bin} $PKG/usr/share/{pixmaps,applications/wifislax/Pentesting}
mv -f MITMf $PKG/opt/
rm -rf $PKG/opt/$SRCNAM/.git
rm -rf $PKG/opt/$SRCNAM/{LICENSE,*.md}

echo '#!/bin/bash
cd /opt/MITMf/
python mitmf.py "$@"' > $PKG/usr/bin/mitmf.py
chmod +x $PKG/opt/$SRCNAM/mitmf.py $PKG/usr/bin/mitmf.py

# Creamos el icono
echo "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
8//T8Awn/bTLegAAAABJRU5ErkJggg==" | base64 -d > $PKG/usr/share/pixmaps/$PRGNAM.png

# Creamos el fichero desktop
echo "[Desktop Entry]
Categories=Redes;
Exec=python /opt/MITMf/mitmf.py --help;bash
Icon=$PRGNAM
Name=MITMf
GenericName=Framework for Man-In-The-Middle attacks
Path=/opt/MITMf
Terminal=true
StartupNotify=false
Type=Application" > $PKG/usr/share/applications/wifislax/Pentesting/$PRGNAM.desktop
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del paquete
f_versionInstalada
# Comprobar dependencias
F_dependencias
#Si no existe el fichero se descargara
f_download
#Cd a ruta
f_cd
#Descomprimir fichero descargado y compilamos
F_compilar
#Creamos xzm , instalamos y salimos
f_tareasFinales