#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20210317

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=bulk_extractor
	GESTOR=git
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB=https://github.com/simsong/$PRGNAM
	RAMA=$(curl -s $WEB|grep commit/|head -1|cut -d / -f5|cut -c1-7)
	VERSION=$(curl -s https://raw.githubusercontent.com/simsong/$PRGNAM/master/configure.ac|grep BULK_EXTRACTOR|head -1|cut -d ' ' -f2|sed 's/.$//g')_$RAMA
	SOURCES=$PRGNAM
	CD=$PRGNAM
	DOWNLOAD=${WEB}
}

# Comprobar dependencias
F_dependencias() {
DEPENDENCIAS="libewf"
f_dependencias
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
echo 
echo "$VERDE"Configurando ..."$CIERRE"
sleep 1
chmod +x bootstrap.sh
./bootstrap.sh
CFLAGS="$SLKCFLAGS" \
CXXFLAGS="$SLKCFLAGS" \
  ./configure \
  --prefix=/usr \
  --libdir=/usr/lib${LIBDIRSUFFIX} \
  --sysconfdir=/etc \
  --localstatedir=/var \
  --mandir=/usr/man \
  --build=$ARCH-slackware-linux

echo 
echo "$VERDE"Compilando ..."$CIERRE"
sleep 1
make || exit 1
make install DESTDIR=$PKG || exit 1

mkdir -p $PKG/usr/share/{pixmaps,applications/wifislax/Forensics}

echo "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
"  | base64 -d >/$PKG/usr/share/pixmaps/$PRGNAM.png

# Entrada menu
echo '[Desktop Entry]
Categories=Forensics;
Exec=sh -c "bulk_extractor;${SHELL:-bash}"
Icon=bulk_extractor
MimeType=
Name[es]=Bulk_extractor
Name=Bulk_extractor
Path=
StartupNotify=false
Terminal=true
TerminalOptions=
Type=Application' > $PKG/usr/share/applications/wifislax/Forensics/$PRGNAM.desktop
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del paquete
f_versionInstalada
# Comprobar dependencias
F_dependencias
#Si no existe el fichero se descargara
f_download
#Preparamos entorno
f_cd
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales