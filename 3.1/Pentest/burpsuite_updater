#!/bin/bash

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20210807

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=burpsuite
	SRCNAM=burpsuite_community
	GESTOR=wget
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB=https://portswigger.net/burp/releases
	VERSION=$(curl -s $WEB|grep community-[0-9]|head -1|cut -dy -f2|cut -d '"' -f1|sed 's/-/./g'|rev|sed 's/.$//g'|rev)
	SOURCES=${SRCNAM}_v$VERSION.jar
	DOWNLOAD=$WEB/download/$SOURCES
}

# Comprobar dependencias
F_dependencias(){
DEPENDENCIAS="jdk"
f_dependencias
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
mkdir -p $PKG/{usr/bin,usr/share/pixmaps,usr/share/applications/wifislax/Pentesting}
mv -f $SOURCES $PKG/usr/bin/

# Creamos un starter para poder llamrlo desde consola burpsuite
echo "#!/bin/bash
java -jar /usr/bin/$SOURCES" > $PKG/usr/bin/$PRGNAM
chmod +x $PKG/usr/bin/$PRGNAM

# Creamos el fichero desktop
echo "[Desktop Entry]
Categories=Pentesting
Exec=$PRGNAM
Icon=$PRGNAM
Name=Burpsuite
Terminal=false
Type=Application" > $PKG/usr/share/applications/wifislax/Pentesting/$PRGNAM.desktop

# Creamos el icono
echo "
iVBORw0KGgoAAAANSUhEUgAAADAAAAAvCAYAAAClgknJAAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
AAAOwwAADsMBx2+oZAAABHpJREFUaIHtmd9vFFUUxz9n7O62k7KmaYMl20i2DbHBuBQ1kUJMoFhq
gWLsLr95UCDoi/+Fz4o/ooaARBITHtSQoCYCVgjgj9AYQARUIECtUrAUbLuzs/Pj+jCw5cfa7m5n
tjzwfdnMuXfPOd8555577xlZs3a9IgAsW7aUDevXAeAM9nFz+xbUUB+iCaKR+9U0AeEumWggIoiM
yZB75gqAoAXhfDkRGAHxXlHgCIRANBqlqbExCNX3IRACHUvamTu3JffsDFxAmSNBmKLCT2WaptHa
Oo8lS9qJRCIAWP1nGD3wIWr0BkFklW8REBGenD2bVDJJdXU1AG5mhNGv3sa+fApUIMXOPwLR6DTW
rFlFff1jAKhshtGej8n+dtQvE3nhCwFd19m0cSPxeBwAZZmkj+7GOPypH+rHxaQJVFZW0tW1nETi
qVzpNM8cYfTgLlwjmIV7JyZN4NlnnmZxW1tu0drXLjH85bu4Q1cm7VwhKLkKiQjNzc1s3ryJSCSC
Ugrnnz+5uftN7L/PBVJx8qHkCDQ0xFi9KpV788rKMLxvB+a5Y0AwFScfSiIQjUZ5acUKmpqaAFCu
S/roF6R/3IOyTF8dnAhFp1A4HCaV7GbBgvkAKMcm/fN+bu59H2WZ3smxjCiKgKZpzG9tzTkPXslU
xgj6c10I5I6+IoDcOgpnRsie/hay/lelggmICC0tc0gmu6mqqhqTh6vQ53VxZ97fu36d6/1Yl3pR
U0kgFouxYf066upq75KLpiHhynH/K6EIQZ3cC9Kq6zqpVDczZswIxInJoKAIGIbBjh072bnzk4IV
t7e/QLL75ZIdKxQFEVBKMTw8XJRiwzBKcqhYPLwTTzUeEphq+Hon/l+IhlY1Ddd8FNEETYBHvMYV
2u0G1h2NLRFQFtgTF4KyENCqa9A73oCsMbZN3+q8MfbojQmIncU5+zXq0g8T6i4LAQnrhJ94vqC5
Sinc84dQA2e9RsAEF4sHbg2oa39gH9qKSl8vaH5gERi4MkBvb++4cxoaGqivr889uzf6sY58gBrq
K9hOYASOnzjBr6dP5x0TEeLxOBtffSUnU5lhrO+345w/jOAU3FsNjIBt29i2nXespqaGzs6OsR6S
62Af/xz71F5EOUUl9pSsga7ly5iTSKBpnnnn90Nkf9oFTn7C46E8+8BtYxUVdL7YQVvbIioqPNP2
xWOYPe+gRgYRrfhWRtkiICIkEom7Gr/u6CDmga24gxdL1lu2CEyfPp11a1dTV1eHUgqyBubBj3D/
OnX/HbQIlCUCtbW1vP7aFmKxmCewMpiHt2Md3zNp3YET0HWdpUs7aWyM52TW2R7M3s986SEFmkIi
wuK2RSxauJBwOIxSLs7lk2T2v4dK3/ClhxQYAa8N08LKlSlCoZB3xrl6gfQ3b+EM9ZdUcfIhsBRq
ampkZSpJKBTyBJaB8d027L6TvtoJjMCsWbOYOfNxwNtp0z3bMH/ZB47jq53ACGialttp3X+vYp7c
V9JOO6Ed3zXmg2M/+B/5pgoPCUw1/gMzbWzgJhkGlgAAAABJRU5ErkJggg==
" | base64 -d > $PKG/usr/share/pixmaps/$PRGNAM.png
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura noarch
#Comprobamos version instalada del paquete
f_versionInstalada
#Compronar dependencias
F_dependencias
#Si no existe el fichero se descargara
f_download
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales