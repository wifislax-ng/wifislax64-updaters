#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20210614
CATEGORIA="Reproductores multimedia"

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=vlc
	EXTENSION=tar.xz
	GESTOR=wget
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB=https://github.com/videolan/vlc
	VERSION=$(curl -s $WEB/releases|grep tar.gz|head -1|cut -d/ -f7|cut -dt -f-1|sed 's/.$//g')
	CD=$PRGNAM-$VERSION
	SOURCES=$PRGNAM-$VERSION.$EXTENSION
	DOWNLOAD=https://download.videolan.org/$PRGNAM/$VERSION/$SOURCES
}

# Comprobar dependencias
F_dependencias(){
DEPENDENCIAS="
dav1d
libgme
libiec61883
libxml++
libconfig
libffado
celt
libass
libdc1394
libdvbpsi
libmpeg2
libupnp
lua
portaudio
twolame 
ffmpeg
freerdp
gsm
numpy3
libtar
libkate
faac
libdca
libebml
libmatroska
libshout
jack
libsidplay2
zvbi
faad2
libavc1394
libmodplug
libcuefile
libreplaygain
musepack-tools
vcdimager
dirac
gnome-vfs
live555
rtmpdump
libdvdcss
schroedinger
libminizip
chromaprint
x264
x265
libaacs
libbdplus
ftgl
aom
libplacebo
libnfs
pytz
python-gflags
google-apputils
protobuf
libdaemon
avahi
srt
"
f_dependencias
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
echo 
echo "$VERDE"Configurando ..."$CIERRE"
sleep 1

echo "
/Td6WFoAAATm1rRGAgAhARYAAAB0L+Wj4Bf/BKNdADgYSu7FL5n6pvg745dpgzgztyjlznaup/KQ
X0/D3YcFPA7mUg0r3m+Ofka/myjePfoYr8gohlzzDAUVlVG7KEfMFvVdUd0ExUiO0KKuNf+AzpAH
TgMtMZwMS0p++LlUIkK/Gk3XIlWJEL+uLnDhdUy35PXYxZbObUPjTki0qtJsW+RRYENl/a6Aww6r
73GAd1t60bJGXRfdI2TAUBDJaFFrXjb8JrBM+OSPYSZmZAMXNQOlVBvaA8vA/cAwdy4b19ecMA/S
p8N0zI5jCYwZSGc4HgctBWFqJJ55qahYxrHZ01zjJ5fDcS5KhbAyhHK+OV4SKFK3dMlvzXy9M979
uiutybztxhxj1LqimfbiFBuO9lRg6AGxDzHHKkEWPP5AAznSfjsJUytdvuCXBLfscs8ip+ZuGgZy
DZOrbEdfNh5CQlZESY7i7UlEsXX6oDBcjLwp/StndWIK8fuadNgnjZC02ucwhlzT1BKUJe4w/3nc
i3YQmui+wVnGrQWfuqciyAFM3uk5SPFkJ9P/NZnYRMXEGtRjKKWniQFrR+AfGbScQvS++PVy4eG9
d7T0AJpxm/uQTznt7RSsybl0mChNUrRFJqpLbSYaovzoQEgULtb579UbPaXyndZRuRS1WlZRdLcH
d4OxUz15cmsM78/+MxjI40oV2YK3qzeY1AMPq9HdIsNJgKiL62/vsHOzMSTjeYileqMVIDwVfm0V
ZFe3ghqiFDRuTf/4QpEye9hj4wNabLOE11s+b/89YZkeD8+ovl8AYxlVwCyUVyA81bgj5vVVpsMS
mtC0CJcLp0GdFmJ6WegvHE6O+Krrjk8gwXRfDVYAxxL5tDNictI8AOy5ITUarJKcZXCKj4bkc3XF
bdNs5vaeljcOspDcY9l97MnIgv24yh6BXEGwmBElFf156T//9ix3lDfwc1YCK0i1++UwQ1fo8+3W
awYQ3wAS71wMymuwft8+9pA2CqDgDjKNshEpQVMOujvMLF5o4Cwz7D4mZKSS+Geg01BWt/YT6bFS
38ePE0PqBNfTpB9oFgFCw88kmP453lO9cA95jhxMnYW55N+0V85q2hp07b7ACpXgbZXU5Domp6E2
7PJKcQtJe61SR+KpTtjrRPltxbpThd7XhT6M+1ZopFFm0tett6m7T/abzuqL5fjbIS3dA+MXYgwp
bDc0zyd+jI0fCIN/L+CFDNkzkz4v/+ir699TvQVFJ0kmgLdi2a1veFu8IaDnq6o6IdVjYVsQSALh
Krk8lhJan56g4SGlgnz9U8O3b1RKzh3z6FOn1qIr2bf9TwNAJBuzZKNTcdEl2cM14RjNViq4qvJa
Dkzg363fTEGd5QLh2oyjUgJhOo9iiUFwr0X8NIp+Uhe6Iq6XiDq9lDnzPl769lG6Y4EnCbSNmC58
qPFIDYivysL3K88IGh4TUiFT0u9V4UeIyRK5c6MVNrMKep1J2EDopBRnHDJnEw5RzsZ6ZXJH7ImL
rbjT3be318ln8TITEdynmDy5defPyzXImuv7Qiqgk39o0y3P7sy5BeqpBBPQZ/oCguyFWOT9WJTw
5y2IxWODBoTdFTFfz//JDcp86HsAAAB7SwkedC1x7wABvwmAMAAAp0Tr7LHEZ/sCAAAAAARZWg=="|base64 -d > $TMP/patches.txz

tar xvf $TMP/patches.txz &>/dev/null

patch -p1 < ./patches/vlc-3.0.11.1-srt_1.4.2.patch
#patch -p1 < ./patches/vlc-live-media-2021.patch

autoreconf -fiv

CFLAGS="$SLKCFLAGS  -I/usr/include/samba-4.0" \
CXXFLAGS="$SLKCFLAGS -std=c++11" \
LDFLAGS="$SLKLDFLAGS" \
./configure \
  --prefix=/usr \
  --libdir=/usr/lib${LIBDIRSUFFIX} \
  --sysconfdir=/etc \
  --mandir=/usr/man \
  --docdir=/usr/doc/vlc-$VERSION \
  --localstatedir=/var \
  --enable-run-as-root \
  --disable-opencv \
  --disable-fdkaac \
  --disable-schroedinger \
  --disable-libgcrypt \
  --disable-update-check \
  --enable-qt=5 \
  --enable-merge-ffmpeg \
  --enable-archive \
  --enable-live555 \
  --enable-dc1394 \
  --enable-dv1394 \
  --enable-dvdread \
  --enable-dvdnav \
  --enable-bluray \
  --enable-smbclient \
  --enable-sftp \
  --enable-nfs \
  --enable-realrtsp \
  --enable-dvbpsi \
  --enable-gme \
  --enable-ogg \
  --enable-shout \
  --enable-matroska \
  --enable-mod \
  --enable-mpc \
  --enable-mad \
  --enable-mpg123 \
  --enable-gst-decode \
  --enable-avcodec \
  --enable-libva \
  --enable-avformat \
  --enable-postproc \
  --enable-faad \
  --enable-vpx \
  --enable-twolame \
  --enable-a52 \
  --enable-dca \
  --enable-flac \
  --enable-libmpeg2 \
  --enable-vorbis \
  --enable-speex \
  --enable-opus \
  --enable-oggspots \
  --enable-png \
  --enable-jpeg \
  --enable-x264 \
  --enable-x265 \
  --enable-zvbi \
  --enable-libass \
  --enable-kate \
  --enable-vdpau \
  --enable-sdl-image \
  --enable-freetype \
  --enable-fribidi \
  --enable-harfbuzz \
  --enable-fontconfig \
  --enable-svg \
  --enable-svgdec \
  --enable-aa \
  --enable-caca \
  --enable-pulse \
  --enable-alsa \
  --enable-jack \
  --enable-samplerate \
  --enable-soxr \
  --enable-chromaprint \
  --enable-chromecast \
  --enable-skins2 \
  --enable-libtar \
  --enable-ncurses \
  --enable-lirc \
  --enable-projectm \
  --enable-avahi \
  --enable-mtp \
  --enable-upnp \
  --enable-libxml2 \
  --enable-gnutls \
  --enable-taglib \
  --enable-secret \
  --enable-notify \
  --enable-libplacebo \
  --enable-vlc \
  --enable-aribsub \
  --enable-aom \
  --enable-dav1d \
  --enable-srt \
  --with-kde-solid=no \
  --build=$ARCH-slackware-linux
  
echo 
echo "$VERDE"Compilando ..."$CIERRE"
sleep 1
make  || exit 1
make install DESTDIR=$PKG || exit 1

install -D -m0644 extras/analyser/vlc.vim $PKG/usr/share/vim/vimfiles/syntax/vlc.vim
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Comprobamos version instalada del script
f_versionInstalada
# Comprobar dependencias
F_dependencias
#Si no existe el fichero se descargara
f_download
#Descomprimir sources
f_descomprimir
#Cd a ruta
f_cd
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales