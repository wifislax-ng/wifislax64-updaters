#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20210725

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=websploit
	EXTENSION=tar.gz
	GESTOR=wget
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB=https://github.com/$PRGNAM/$PRGNAM
	VERSION=$(curl -s $WEB/releases|grep $EXTENSION|head -1|cut -d/ -f7|cut -dt -f1|sed 's/.$//g')
	SOURCES=$VERSION.$EXTENSION
	CD=$PRGNAM-$VERSION
	DOWNLOAD=$WEB/archive/refs/tags/$SOURCES
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
mkdir -p $PKG/{,usr/bin,usr/share/pixmaps,usr/share/applications/wifislax/Pentesting}
echo ""
echo "$VERDE"Instalando..."$CIERRE"
sleep 1
python3 setup.py build
python3 setup.py install --root=$PKG

# Creamos icono
echo "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
" | base64 -d > $PKG/usr/share/pixmaps/$PRGNAM.png

# Creamos la entrada al menu 
echo "[Desktop Entry]
Categories=Pentesting;
Exec=$PRGNAM
Icon=$PRGNAM
MimeType=
Name=Websploit
Path=
StartupNotify=true
Terminal=true
TerminalOptions=
Type=Application" > $PKG/usr/share/applications/wifislax/Pentesting/$PRGNAM.desktop
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del script
f_versionInstalada
#Si no existe el fichero se descargara
f_download
#Descomprimir sources
f_descomprimir
#Cd a ruta
f_cd
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales