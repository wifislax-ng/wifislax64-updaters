#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20181122

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=WebSploit-Framework
	EXTENSION=tar.gz
	GESTOR=wget
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB="https://sourceforge.net/projects/websploit/files/latest/download?source=files"
	VERSION=$(curl -s $WEB|grep $EXTENSION|grep -Po 'href="\K.*(?=")'|cut -d? -f1|cut -d- -f3|cut -dt -f-1|sed 's/.$//g')
	SOURCES=$PRGNAM-$VERSION.$EXTENSION
	DOWNLOAD=https://downloads.sourceforge.net/project/websploit/WebSploit%20Framework%20V.$VERSION/$SOURCES
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
mkdir -p $PKG/{,usr/bin,usr/share/pixmaps,usr/share/applications/wifislax/Pentesting}
echo ""
echo "$VERDE"Descomprimiendo ..."$CIERRE"
sleep 1
cd $TMP
rm -rf $PRGNAM-$VERSION
ark --batch --autodestination $SOURCES
# Configuramos paquete
echo ""
echo "$VERDE"Configurando..."$CIERRE"
sleep 1
cd $TMP/websploit
chmod +x install.sh
#Aprovechamos el install existente para hacer mas rapido la tarea
echo "`cat install.sh | sed 's/\/usr/$PKG\/usr/g' | grep ^echo -v | grep -v ^ln`" > install.sh
# Hay un bug en el install.sh de la version 3.0.0
if [ $VERSION = 3.0.0 ]; then
echo "`cat install.sh |sed 's/tar -xf wsf-205.tar.gz/tar -xf wsf-300.tar.gz/g'`" > install.sh
fi
./install.sh
#Esto mejor lo hacemos manualmente
ln -s /usr/share/websploit/websploit $PKG/usr/bin/websploit

#Creamos icono
echo "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
nU7VsgAAAABJRU5ErkJggg==" | base64 -d > $PKG/usr/share/pixmaps/websploit.png

# Creamos la entrada al menu 
echo "[Desktop Entry]
Categories=Pentesting;
Exec=websploit
Icon=websploit
MimeType=
Name=Websploit
Path=
StartupNotify=true
Terminal=true
TerminalOptions=
Type=Application" > $PKG/usr/share/applications/wifislax/Pentesting/$PRGNAM.desktop
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura noarch
#Comprobamos version instalada del script
f_versionInstalada
#Si no existe el fichero se descargara
f_download
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales